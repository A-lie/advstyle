# 广告设置系统需求文档

1. 资源管理

管理对象：构成播放内容的基本元素（视频、图片、文字）。

1.1 文件列表视图

显示字段：
• 缩略图

• 原始文件名

• 文件类型

• 所属分组

• 分辨率（宽高）

• 文件大小

• MD5值

• 备注

1.2 核心功能

• 上传文件

• 删除文件

• 预览文件

1.3 搜索与筛选

按文件名、类型、分组等条件快速查找资源。

2. 节目编排

管理对象：在指定尺寸的画布上，将多个资源组合成一个完整的播放页面。

2.1 节目列表视图

显示字段：
• 节目id

• 节目名称

• 屏幕宽

• 屏幕高

• 是否全屏

• 分组（节目）

• 描述

搜索与筛选：节目名称、屏幕宽、屏幕高、是否全屏、分组。

2.2 节目明细结构

2.2.1 区域属性

• 区域id

• 区域名称

• 类型（视频/图片/文字）

• 坐标x

• 坐标y

• 区域宽

• 区域高

• 背景颜色

• 透明度（0-255）

2.2.2 资源明细属性

• 资源id

• 原始文件名

• 类型

2.2.3 类型相关属性

• 视频：

    ◦ 分辨率

    ◦ 显示方式（等比例居中/拉伸）

• 图片：

    ◦ 分辨率

    ◦ 显示方式（等比例居中/拉伸）

    ◦ 显示时间（ms）

• 文字：

    ◦ 显示方式（左对齐、居中、右对齐、滚动）

    ◦ 文本内容

    ◦ 字体名称（Android）

    ◦ 字体颜色

    ◦ 字体大小

    ◦ 滚动速度0-9级（越大越快）

    ◦ 是否加粗

2.3 核心功能

2.3.1 节目级操作

• 添加节目：创建新节目，设定画布尺寸（宽高）。

• 修改节目：编辑节目基本信息。

• 删除节目：删除节目定义。

• 预览播放：预览节目的最终播放效果。包括：

    ◦ 在线预览：直接在前端播放当前排版。

    ◦ 设定SN临时推送播放：

        ▪ 一个输入框输入SN

        ▪ 一个预览按钮

        ▪ 一个取消预览按钮

        ▪ 点击预览按钮，将当前设置生成JSON发送到指定的SN设备

        ▪ 点击取消预览按钮，从数据库检索该设备的有效节目列表下发SN设备（同7001指令响应）

2.3.2 区域级操作

• 添加区域：在节目画布上新增一个内容区域，并定义其属性和位置。

• 修改区域：调整区域的位置、大小、属性等。

• 删除区域：移除指定区域。

• 上下移动区域：调整不同区域的图层叠加顺序（最后的在最顶层）。

2.3.3 资源关联操作

• 添加资源：为指定区域关联多个资源。

• 修改资源：更换区域内的资源或调整其显示属性（如显示方式、播放时长等）。

3. 播放设置

管理对象：将节目在特定的时间、下发给特定的终端，并控制其播放行为。

3.1 播放列表视图

显示字段：
• 播放任务id

• 播放任务名称

• SN匹配方式

• 设备SN号

• 机型

• 分组（播放任务）

• 有效期开始

• 有效期结束

• 每日播放开始时间

• 每日播放结束时间

• 关联的节目ID

• 周一至周日有效性

• 状态（启用/停用）

• 描述

3.2 核心功能

• 添加播放任务：创建新的播放任务，配置所有相关参数。

• 修改播放任务：调整现有播放任务的各项设置。

• 删除播放任务：移除播放任务。

• 启用/停用任务：快速控制某个播放任务是否生效，无需删除。

• 搜索与筛选：任务名称、SN号、机型、分组、有效期日期、播放时间、状态。

4. JSON 接口定义

4.1 A. 获取广告播放任务列表 (7001)

终端请求
• 主题：v1/devices/request

• method: 7001

• params: 当前为空JSONObject,即字符串 {}

• 描述：终端（广告机）在MQTT连接后请求一次，获取广告播放任务列表。

平台响应
• 主题：v1/rpc/respone/{sn}

• method: 7001

• data: JSONObject

    ◦ 字段:

        ▪ playlist: JSONArray - 每个元素为一个广告播放任务JSONObject

广告播放任务对象 (playlist 元素) 字段定义

字段 类型 描述

playid String 广告播放任务唯一id

playname String 任务名称

date_start String 有效期开始,格式 yyyy-MM-dd

date_end String 有效期结束,格式 yyyy-MM-dd

time_start String 播放时间开始,格式 HH:mm:ss

time_end String 播放时间结束,格式 HH:mm:ss

playstatus boolean 状态, false-停用, true-启用

is_mon boolean 周一状态, false-停用, true-启用

is_tue boolean 周二状态, false-停用, true-启用

is_wed boolean 周三状态, false-停用, true-启用

is_thu boolean 周四状态, false-停用, true-启用

is_fri boolean 周五状态, false-停用, true-启用

is_sat boolean 周六状态, false-停用, true-启用

is_sun boolean 周日状态, false-停用, true-启用

advert JSONObject 节目对象
节目对象 (advert) 字段定义
字段 类型 描述

advertid String 节目唯一id

advertname String 节目名称

fullscreen boolean 是否全屏：当为true时,多个区域是按顺序播放,为false时,多个区域是同时播放。为true时屏幕宽、屏幕高、区域宽、区域高、区域起点坐标x、y等参数无效。

screenwidth int 屏幕宽

screenheight int 屏幕高

duration int 播放时长,单位毫秒。0为不限定。注意：只有存在2个或以上的节目时才有效。如果同时设置了时长和循环次数,则先满足条件的生效。

repeat int 循环次数,0为不限定。注意：同上。

arealist JSONArray 区域列表,每个元素为一个区域对象
区域对象 (arealist 元素) 字段定义
字段 类型 描述

areaid String 区域唯一id

areaname String 区域名称

areax int 区域起点坐标x

areay int 区域起点坐标y

areawidth int 区域宽

areaheight int 区域高

areatype int 区域类型: 0-文本, 1-图片, 2-视频

alpha int 透明度 0-255

bkcolor String 背景颜色,为Web标准表示颜色字符串格式,如"#FF6B35"

reslist JSONArray 资源列表,包含的资源类型必须与区域类型一致
资源对象 (reslist 元素) 字段定义
字段 类型 描述

resid String 资源唯一id

file JSONObject 文件字段参数格式定义,文本类型时为null

show int 显示方式：<br/>- 文本(areatype=0): 0-左对齐,1-居中,2-右对齐,3-滚动<br/>- 图片(areatype=1)/视频(areatype=2): 0-居中(保持长宽比),1-拉伸平铺

showtime int 图片/文本显示时间,单位ms, areatype=0或1时有效

text String 显示的文本, areatype=0时有效

font JSONObject 文本字体结构, areatype=0时有效,其它为null
字体对象 (font) 字段定义
字段 类型 描述

fontname String 字体名称,为android系统标准字体

textcolor String 字体颜色,为Web标准表示颜色字符串格式,如"#FF6B35"

fontsize int 字体大小

bold int 字体加粗: 0-正常, 1-加粗

roll int 滚动速度, 1-9, 值越大越快

4.2 B. 广告播放任务变更通知 (7002)

广告播放任务变更（任务删除、添加、修改）时，平台应推送到相关联的在线终端，未在线终端不推送。

平台发布主题：
• 通知商户所有在线终端：v1/rpc/{商户id}/android/request

• 通知商户所有在线某个机型终端：v1/rpc/{商户id}/{机型}/request

• 通知所有在线终端：v1/rpc/alldevice/android/request

• method: 7002

• params: JSONObject

    ◦ 字段:

        ▪ type: int - 0为删除, 1为添加或修改

        ▪ playlist: JSONArray

            ▪ 当 type 为 0 (删除) 时：数组元素可以只有一个字段 playid（类型为int），表示要删除的播放任务唯一ID。

            ▪ 当 type 为 1 (添加/修改) 时：数组元素字段定义与 7001 中 playlist 定义相同。
# 播放设置功能快速开始

## 🚀 快速启动

```bash
# 安装依赖（如果还没安装）
npm install

# 启动开发服务器
npm run dev
```

访问 http://localhost:8080

## 📋 功能导航

### 1. 播放设置页面
**路径**: `/schedule`

**功能**:
- 查看所有播放任务
- 添加新的播放任务
- 编辑现有任务
- 删除任务
- 启用/停用任务
- 搜索和筛选任务

**操作步骤**:
1. 点击顶部导航栏的"播放设置"
2. 点击"添加播放任务"按钮
3. 填写表单：
   - 任务名称：例如"商场早间广告"
   - SN匹配方式：选择"精确匹配"、"前缀匹配"或"全部设备"
   - 设备SN号：例如"SN20231001"
   - 有效期：选择开始和结束日期
   - 播放时间：选择每天的播放时间段
   - 关联节目：从下拉列表选择节目
   - 周期设置：勾选需要播放的星期
4. 点击"确定"保存

### 2. JSON预览页面
**路径**: `/viewer`

**功能**:
- 模拟设备请求播放列表
- 查看7001接口返回的JSON数据
- 查看7002变更通知日志
- 复制JSON数据

**操作步骤**:
1. 点击顶部导航栏的"JSON预览"
2. 输入设备SN号（例如：SN20231001）
3. 点击"请求播放列表"
4. 查看返回的JSON数据
5. 可以点击"复制JSON"按钮复制数据用于测试

## 🎯 典型使用场景

### 场景1：为特定设备创建播放任务

```
任务名称: 一楼大厅广告
SN匹配方式: 精确匹配
设备SN号: SN20231001
有效期: 2025-01-01 ~ 2025-12-31
播放时间: 08:00:00 ~ 22:00:00
关联节目: 早间促销广告
周期: 周一至周日全选
状态: 启用
```

### 场景2：为一批设备创建播放任务（前缀匹配）

```
任务名称: 二楼所有设备广告
SN匹配方式: 前缀匹配
设备SN号: SN2023  (所有以SN2023开头的设备都会匹配)
有效期: 2025-01-01 ~ 2025-06-30
播放时间: 09:00:00 ~ 18:00:00
关联节目: 下午品牌广告
周期: 仅周末（周六、周日）
状态: 启用
```

### 场景3：为所有设备创建播放任务

```
任务名称: 全场通知
SN匹配方式: 全部设备
有效期: 2025-01-01 ~ 2025-01-31
播放时间: 10:00:00 ~ 20:00:00
关联节目: 晚间通知字幕
周期: 周一至周日全选
状态: 启用
```

## 🔍 测试流程

### 1. 测试添加任务
1. 进入播放设置页面
2. 点击"添加播放任务"
3. 填写表单并保存
4. 查看列表中是否出现新任务
5. 打开控制台，查看7002通知日志

### 2. 测试编辑任务
1. 点击任务的"编辑"按钮
2. 修改任务信息
3. 保存
4. 查看列表中的更新
5. 打开控制台，查看7002通知日志

### 3. 测试删除任务
1. 点击任务的"删除"按钮
2. 确认删除
3. 查看列表中任务已移除
4. 打开控制台，查看7002通知日志

### 4. 测试设备请求
1. 进入JSON预览页面
2. 输入设备SN号（例如：SN20231001）
3. 点击"请求播放列表"
4. 查看返回的JSON数据
5. 验证返回的任务是否符合SN匹配规则

### 5. 测试搜索筛选
1. 在播放设置页面
2. 在搜索栏输入任务名称
3. 选择状态（启用/停用）
4. 点击"搜索"按钮
5. 查看筛选结果

## 📊 Mock数据说明

系统预置了以下Mock数据：

### 播放任务（3个）
1. **早间广告任务** (play_001)
   - SN: SN20231001 (精确匹配)
   - 时间: 08:00-12:00
   - 周期: 周一至周六
   - 状态: 启用

2. **下午广告任务** (play_002)
   - SN: SN2023 (前缀匹配)
   - 时间: 14:00-18:00
   - 周期: 每天
   - 状态: 启用

3. **晚间滚动字幕** (play_003)
   - SN: SN20231002 (精确匹配)
   - 时间: 18:00-22:00
   - 周期: 周五至周日
   - 状态: 停用

### 节目列表（4个）
1. 早间促销广告 (adv_001)
2. 下午品牌广告 (adv_002)
3. 晚间通知字幕 (adv_003)
4. 周末特惠广告 (adv_004)

## 🛠️ 开发调试

### 查看API调用日志
打开浏览器控制台（F12），可以看到：
- Mock API请求和响应
- 7002变更通知
- 错误信息

### 修改Mock数据
编辑文件：`src/services/mockApi.js`

找到 `mockPlayList` 和 `mockAdvertList` 数组，可以：
- 添加新的Mock数据
- 修改现有数据
- 删除数据

### 调整延迟时间
在 `mockApi.js` 中修改 `delay` 函数的默认值：
```javascript
const delay = (ms = 500) => new Promise(resolve => setTimeout(resolve, ms))
```

## ⚠️ 注意事项

1. **数据持久化**: 当前使用内存存储，刷新页面后数据会重置
2. **7002通知**: 仅在控制台输出，未实际推送到MQTT
3. **时间格式**: 
   - 日期格式：yyyy-MM-dd
   - 时间格式：HH:mm:ss
4. **SN匹配**: 
   - 精确匹配：完全相同
   - 前缀匹配：startsWith
   - 全部设备：不检查SN

## 📝 下一步

1. 查看 [PLAY_SCHEDULE_README.md](./PLAY_SCHEDULE_README.md) 了解详细功能说明
2. 查看 [需求文档.md](./需求文档.md) 了解完整需求
3. 开始接入真实的后端API
4. 集成MQTT实现设备通信

## 🐛 常见问题

**Q: 为什么刷新页面后数据丢失了？**
A: 当前使用Mock数据存储在内存中，刷新页面会重置。需要接入后端API实现持久化。

**Q: 如何查看7002通知？**
A: 打开浏览器控制台（F12），在Console标签页可以看到所有7002通知日志。也可以在JSON预览页面查看通知历史。

**Q: SN匹配规则是什么？**
A: 
- 精确匹配：设备SN必须与配置的SN完全相同
- 前缀匹配：设备SN以配置的SN开头即可
- 全部设备：匹配所有设备，不检查SN

**Q: 如何测试不同设备的播放列表？**
A: 在JSON预览页面输入不同的设备SN号，点击"请求播放列表"，系统会根据SN匹配规则返回该设备应该播放的任务列表。

**Q: 周期设置如何工作？**
A: 只有勾选的星期才会播放。例如只勾选周六和周日，则该任务只在周末播放。

## 💡 提示

- 使用浏览器的开发者工具（F12）可以更好地调试
- 在JSON预览页面可以看到完整的数据结构
- 控制台会输出所有Mock API的调用信息
- 建议先熟悉Mock数据，再进行功能测试

# 完整工作流程指南

## 🎯 从设计到播放的完整流程

本指南将带你完成从广告设计到设备播放的完整流程。

## 📋 流程概览

```
1. 广告设计器 → 设计广告内容
2. 保存为节目 → 生成节目数据
3. 播放设置 → 创建播放任务
4. 设备播放 → 推送到终端设备
```

## 🚀 详细步骤

### 第一步：设计广告内容

#### 1.1 打开广告设计器
- 访问：http://localhost:8080/#/designer
- 或点击顶部导航栏的"广告设计器"

#### 1.2 设置画布尺寸
在左侧组件库中设置屏幕尺寸：
- 常用尺寸：
  - 1920 × 1080 (Full HD)
  - 3840 × 2160 (4K)
  - 1280 × 720 (HD)
- 或自定义尺寸

#### 1.3 输入节目名称
在编辑区域顶部的输入框中输入节目名称：
```
示例：商场促销广告
```

#### 1.4 添加设计元素

**添加文字滚动**：
1. 拖拽"文字"组件到画布
2. 在右侧属性面板设置：
   - 文本内容："欢迎光临！本周末全场8折优惠！"
   - 对齐方式：滚动
   - 字体大小：48
   - 字体颜色：红色 (#FF0000)
   - 滚动速度：5
   - 位置：底部（y: 980）
   - 尺寸：1920 × 100

**添加图片轮播**：
1. 拖拽"图片"组件到画布
2. 上传多张产品图片
3. 在右侧属性面板设置：
   - 显示方式：等比例居中
   - 切换间隔：5000ms
   - 位置：居中
   - 尺寸：800 × 600

**添加视频播放**：
1. 拖拽"视频"组件到画布
2. 上传视频文件（推荐MP4格式）
3. 在右侧属性面板设置：
   - 显示方式：拉伸填充
   - 自动播放：是
   - 循环播放：是
   - 位置：全屏
   - 尺寸：1920 × 1080

#### 1.5 调整元素
- 拖动元素调整位置
- 拖动边角调整大小
- 使用属性面板精确设置
- 调整元素层级（上移/下移）

#### 1.6 预览效果
点击"预览"按钮查看最终效果：
- 文字滚动效果
- 图片轮播效果
- 视频播放效果

### 第二步：保存为节目

#### 2.1 确认节目名称
确保已输入节目名称，例如："商场促销广告"

#### 2.2 点击保存为节目
点击工具栏中的"保存为节目"按钮（橙色）

#### 2.3 确认保存
系统会自动：
- ✅ 验证节目名称
- ✅ 验证设计元素
- ✅ 转换为节目格式
- ✅ 保存到节目列表

#### 2.4 查看提示
成功后会显示：
```
节目"商场促销广告"已保存，可在播放设置中关联使用
```

#### 2.5 选择跳转
弹出确认对话框：
```
节目已保存成功，是否跳转到播放设置页面创建播放任务？
[立即跳转] [稍后再说]
```

**建议**：点击"立即跳转"，直接进入下一步

### 第三步：创建播放任务

#### 3.1 进入播放设置
- 如果选择了跳转，会自动进入播放设置页面
- 或手动访问：http://localhost:8080/#/schedule
- 或点击顶部导航栏的"播放设置"

#### 3.2 添加播放任务
点击"添加播放任务"按钮

#### 3.3 填写任务信息

**基本信息**：
```
任务名称：一楼大厅促销广告
分组：商场一楼
描述：一楼大厅的促销广告播放
```

**设备配置**：
```
SN匹配方式：精确匹配
设备SN号：SN20231001
机型：AD-1080P
```

**时间配置**：
```
有效期：2025-01-01 ~ 2025-12-31
播放时间：08:00:00 ~ 22:00:00
周期：周一至周日（全选）
```

**节目关联**：
```
关联节目：商场促销广告 ← 选择刚才保存的节目
```

**状态**：
```
状态：启用
```

#### 3.4 保存任务
点击"确定"按钮保存播放任务

#### 3.5 查看任务列表
在播放任务列表中可以看到刚创建的任务：
- 任务名称：一楼大厅促销广告
- 设备SN：SN20231001
- 播放时间：08:00:00 ~ 22:00:00
- 关联节目：商场促销广告
- 状态：启用（绿色开关）

### 第四步：查看JSON数据（可选）

#### 4.1 进入JSON预览
访问：http://localhost:8080/#/viewer

#### 4.2 模拟设备请求
```
设备SN：SN20231001
```
点击"请求播放列表"

#### 4.3 查看返回数据
可以看到完整的JSON数据：
```json
{
  "success": true,
  "method": 7001,
  "data": {
    "playlist": [
      {
        "playid": "play_xxx",
        "playname": "一楼大厅促销广告",
        "date_start": "2025-01-01",
        "date_end": "2025-12-31",
        "time_start": "08:00:00",
        "time_end": "22:00:00",
        "playstatus": true,
        "is_mon": true,
        "is_tue": true,
        ...
        "advert": {
          "advertid": "adv_xxx",
          "advertname": "商场促销广告",
          "screenwidth": 1920,
          "screenheight": 1080,
          "arealist": [
            {
              "areaid": "area_1",
              "areaname": "文字 1",
              "areatype": 0,
              "reslist": [...]
            }
          ]
        }
      }
    ]
  }
}
```

#### 4.4 复制JSON（可选）
点击"复制JSON"按钮，可以将数据复制用于测试

### 第五步：设备播放（实际环境）

在实际环境中，设备会：

#### 5.1 连接MQTT
设备连接到MQTT服务器

#### 5.2 请求播放列表
设备发送7001请求：
```json
{
  "method": 7001,
  "params": {}
}
```

#### 5.3 接收播放列表
平台返回适用的播放任务列表

#### 5.4 开始播放
设备根据播放任务配置开始播放广告内容

#### 5.5 接收变更通知
当播放任务变更时，设备会收到7002通知并更新播放列表

## 🎨 实际案例

### 案例1：商场促销广告

**需求**：
- 在商场一楼大厅播放促销广告
- 包含滚动文字和产品图片
- 每天8:00-22:00播放
- 全年有效

**实现步骤**：

1. **设计广告**：
   - 节目名称："商场促销广告"
   - 画布：1920 × 1080
   - 添加图片组件（产品图片轮播）
   - 添加文字组件（底部滚动文字）

2. **保存节目**：
   - 点击"保存为节目"
   - 确认保存成功

3. **创建任务**：
   - 任务名称："一楼大厅促销"
   - 设备SN：SN20231001
   - 时间：08:00-22:00
   - 周期：每天
   - 关联节目："商场促销广告"

4. **验证**：
   - 在JSON预览中查看数据
   - 确认设备能正确接收

### 案例2：周末特惠广告

**需求**：
- 仅在周末播放
- 全屏视频广告
- 下午2点到晚上8点
- 多个设备同时播放

**实现步骤**：

1. **设计广告**：
   - 节目名称："周末特惠"
   - 画布：1920 × 1080
   - 添加视频组件（全屏）
   - 上传特惠宣传视频

2. **保存节目**：
   - 点击"保存为节目"

3. **创建任务**：
   - 任务名称："周末特惠活动"
   - SN匹配方式：前缀匹配
   - 设备SN：SN2023（匹配所有以SN2023开头的设备）
   - 时间：14:00-20:00
   - 周期：仅周六、周日
   - 关联节目："周末特惠"

### 案例3：多区域组合广告

**需求**：
- 上半部分播放视频
- 下半部分显示滚动文字
- 全天候播放
- 特定设备

**实现步骤**：

1. **设计广告**：
   - 节目名称："组合广告"
   - 画布：1920 × 1080
   - 添加视频组件：
     - 位置：(0, 0)
     - 尺寸：1920 × 900
   - 添加文字组件：
     - 位置：(0, 900)
     - 尺寸：1920 × 180
     - 对齐：滚动

2. **保存节目**：
   - 点击"保存为节目"

3. **创建任务**：
   - 任务名称："组合广告播放"
   - SN匹配方式：精确匹配
   - 设备SN：SN20231002
   - 时间：00:00-23:59
   - 周期：每天
   - 关联节目："组合广告"

## ⚠️ 注意事项

### 设计阶段
1. ✅ 确保输入节目名称
2. ✅ 至少添加一个元素
3. ✅ 检查元素位置和大小
4. ✅ 预览效果确认无误

### 保存节目
1. ✅ 使用有意义的节目名称
2. ✅ 避免重复的节目名称
3. ✅ 确认所有元素配置完整

### 创建任务
1. ✅ 选择正确的节目
2. ✅ 设置正确的设备SN
3. ✅ 配置合理的播放时间
4. ✅ 选择正确的周期

### 数据验证
1. ✅ 在JSON预览中验证数据
2. ✅ 检查节目是否正确关联
3. ✅ 确认设备能正确匹配

## 🔧 故障排查

### 问题1：保存节目失败
**原因**：
- 未输入节目名称
- 没有添加元素

**解决**：
- 输入节目名称
- 至少添加一个元素

### 问题2：播放任务中看不到节目
**原因**：
- 节目未保存成功
- 页面未刷新

**解决**：
- 重新保存节目
- 刷新播放设置页面

### 问题3：设备收不到播放列表
**原因**：
- SN匹配不正确
- 任务未启用
- 不在播放时间内

**解决**：
- 检查SN匹配方式
- 确认任务已启用
- 检查播放时间和周期

## 💡 最佳实践

### 1. 节目命名
使用清晰、有意义的名称：
- ✅ "商场促销广告"
- ✅ "品牌宣传片"
- ❌ "广告1"
- ❌ "test"

### 2. 任务命名
包含位置和用途信息：
- ✅ "一楼大厅促销广告"
- ✅ "二楼电梯口品牌宣传"
- ❌ "任务1"

### 3. 时间设置
合理设置播放时间：
- 营业时间播放
- 避免深夜播放
- 考虑客流高峰期

### 4. 周期设置
根据实际需求设置：
- 工作日：周一至周五
- 周末：周六、周日
- 全周：全选

### 5. 设备管理
合理使用SN匹配：
- 单个设备：精确匹配
- 同区域设备：前缀匹配
- 全部设备：全部设备模式

## 🎉 总结

通过以上流程，你可以：

1. ✅ 在广告设计器中设计专业的广告内容
2. ✅ 将设计保存为可复用的节目
3. ✅ 创建灵活的播放任务
4. ✅ 精确控制播放时间和设备
5. ✅ 实现完整的广告播放管理

这个完整的工作流程打通了从设计到播放的所有环节，让广告管理变得简单高效！

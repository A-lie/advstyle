# 播放设置功能演示说明

## 🎬 功能演示流程

### 演示1：查看播放任务列表

**步骤**:
1. 启动项目：`npm run dev`
2. 访问：http://localhost:8080
3. 点击顶部导航栏的"播放设置"
4. 查看预置的3个播放任务

**预期结果**:
- 显示3个播放任务：
  - 早间广告任务（启用）
  - 下午广告任务（启用）
  - 晚间滚动字幕（停用）
- 每个任务显示完整信息：ID、名称、SN、时间、周期、状态等
- 周期用彩色标签展示（绿色=启用，灰色=停用）

---

### 演示2：添加新的播放任务

**步骤**:
1. 在播放设置页面，点击"添加播放任务"按钮
2. 填写表单：
   ```
   任务名称: 周末特惠广告
   SN匹配方式: 精确匹配
   设备SN号: SN20231003
   机型: AD-4K
   分组: 商场四楼
   有效期: 2025-01-01 ~ 2025-12-31
   播放时间: 10:00:00 ~ 20:00:00
   关联节目: 周末特惠广告
   周期: 仅勾选周六和周日
   状态: 启用
   描述: 周末特惠活动广告
   ```
3. 点击"确定"按钮

**预期结果**:
- 显示"添加成功"提示
- 列表中出现新任务
- 控制台输出7002通知（type: 1, 添加/修改）
- 新任务的周期标签只有周六和周日是绿色

---

### 演示3：编辑播放任务

**步骤**:
1. 找到"早间广告任务"
2. 点击"编辑"按钮
3. 修改播放时间为：07:00:00 ~ 11:00:00
4. 修改周期：取消勾选周日
5. 点击"确定"

**预期结果**:
- 显示"更新成功"提示
- 列表中的任务信息已更新
- 播放时间显示为：07:00:00 ~ 11:00:00
- 周日标签变为灰色
- 控制台输出7002通知（type: 1, 添加/修改）

---

### 演示4：启用/停用任务

**步骤**:
1. 找到"晚间滚动字幕"任务（当前是停用状态）
2. 点击状态开关，切换为启用
3. 再次点击开关，切换回停用

**预期结果**:
- 每次切换都显示"状态更新成功"提示
- 开关状态实时变化
- 控制台输出7002通知（每次切换都会触发）

---

### 演示5：删除播放任务

**步骤**:
1. 找到刚才添加的"周末特惠广告"任务
2. 点击"删除"按钮
3. 在确认对话框中点击"确定"

**预期结果**:
- 显示"删除成功"提示
- 任务从列表中移除
- 控制台输出7002通知（type: 0, 删除）

---

### 演示6：搜索和筛选

**步骤**:
1. 在搜索栏输入"早间"
2. 点击"搜索"按钮
3. 清空搜索，选择状态为"启用"
4. 点击"搜索"按钮
5. 在设备SN号输入"SN2023"
6. 点击"搜索"按钮

**预期结果**:
- 第一次搜索：只显示"早间广告任务"
- 第二次搜索：显示所有启用的任务
- 第三次搜索：显示SN包含"SN2023"的任务

---

### 演示7：查看JSON数据（设备请求模拟）

**步骤**:
1. 点击顶部导航栏的"JSON预览"
2. 在设备SN输入框中输入：SN20231001
3. 点击"请求播放列表"按钮
4. 查看返回的JSON数据

**预期结果**:
- 显示"播放列表获取成功"提示
- 显示完整的JSON数据结构
- JSON中只包含匹配SN20231001的任务（精确匹配）
- JSON格式化显示，易于阅读

---

### 演示8：测试SN前缀匹配

**步骤**:
1. 在JSON预览页面
2. 将设备SN改为：SN20231005（任意以SN2023开头的SN）
3. 点击"请求播放列表"按钮
4. 查看返回的JSON数据

**预期结果**:
- 返回的任务列表包含：
  - "早间广告任务"（SN精确匹配：SN20231001，不匹配）
  - "下午广告任务"（SN前缀匹配：SN2023，匹配✓）
  - "晚间滚动字幕"（已停用，不返回）

---

### 演示9：复制JSON数据

**步骤**:
1. 在JSON预览页面
2. 点击"复制JSON"按钮
3. 打开文本编辑器，粘贴（Ctrl+V 或 Cmd+V）

**预期结果**:
- 显示"JSON已复制到剪贴板"提示
- 粘贴的内容是完整的JSON数据
- 格式化良好，可直接用于测试

---

### 演示10：查看7002通知日志

**步骤**:
1. 在播放设置页面，执行以下操作：
   - 添加一个新任务
   - 编辑一个任务
   - 删除一个任务
   - 切换一个任务的状态
2. 切换到JSON预览页面
3. 向下滚动查看"7002变更通知日志"

**预期结果**:
- 显示时间线形式的通知日志
- 每条日志包含：
  - 时间戳
  - 操作类型（删除/添加/修改）
  - 完整的通知数据
- 最新的通知在最上面
- 最多显示10条历史记录

---

## 🎯 关键功能验证点

### 1. SN匹配逻辑验证

| 任务配置 | 设备SN | 是否匹配 | 说明 |
|---------|--------|---------|------|
| 精确匹配: SN20231001 | SN20231001 | ✓ | 完全相同 |
| 精确匹配: SN20231001 | SN20231002 | ✗ | 不相同 |
| 前缀匹配: SN2023 | SN20231001 | ✓ | 以SN2023开头 |
| 前缀匹配: SN2023 | SN20231002 | ✓ | 以SN2023开头 |
| 前缀匹配: SN2023 | SN20241001 | ✗ | 不以SN2023开头 |
| 全部设备 | 任意SN | ✓ | 匹配所有 |

### 2. 状态过滤验证

| 任务状态 | 设备请求时 | 是否返回 |
|---------|-----------|---------|
| 启用 | 任意时间 | ✓ |
| 停用 | 任意时间 | ✗ |

### 3. 周期设置验证

**示例任务**: 只勾选周六和周日

| 当前星期 | 是否播放 |
|---------|---------|
| 周一 | ✗ |
| 周二 | ✗ |
| 周三 | ✗ |
| 周四 | ✗ |
| 周五 | ✗ |
| 周六 | ✓ |
| 周日 | ✓ |

### 4. 表单验证

| 字段 | 验证规则 | 错误提示 |
|-----|---------|---------|
| 任务名称 | 必填 | "请输入任务名称" |
| SN匹配方式 | 必选 | "请选择SN匹配方式" |
| 设备SN号 | 必填（非全部设备时） | "请输入设备SN号" |
| 有效期 | 必选 | "请选择有效期" |
| 播放时间 | 必选 | "请选择播放时间" |
| 关联节目 | 必选 | "请选择关联节目" |

---

## 🔍 调试技巧

### 1. 查看控制台日志

打开浏览器控制台（F12），可以看到：

```
模拟7002通知 - 添加任务: {
  method: 7002,
  params: {
    type: 1,
    playlist: [...]
  }
}
```

### 2. 查看Mock API调用

每次API调用都会在控制台输出：
- 请求参数
- 响应数据
- 执行时间

### 3. 查看数据结构

在JSON预览页面可以看到完整的数据结构，包括：
- 播放任务对象
- 节目对象
- 区域对象
- 资源对象

### 4. 修改Mock数据

编辑 `src/services/mockApi.js`：
```javascript
// 修改延迟时间
const delay = (ms = 500) => ...

// 添加Mock数据
let mockPlayList = [
  // 在这里添加新的任务
]
```

---

## 📊 数据示例

### 完整的播放任务JSON示例

```json
{
  "playid": "play_001",
  "playname": "早间广告任务",
  "snMatchType": "exact",
  "sn": "SN20231001",
  "deviceModel": "AD-1080P",
  "group": "商场一楼",
  "date_start": "2025-01-01",
  "date_end": "2025-12-31",
  "time_start": "08:00:00",
  "time_end": "12:00:00",
  "playstatus": true,
  "is_mon": true,
  "is_tue": true,
  "is_wed": true,
  "is_thu": true,
  "is_fri": true,
  "is_sat": true,
  "is_sun": false,
  "advert": {
    "advertid": "adv_001",
    "advertname": "早间促销广告",
    "fullscreen": false,
    "screenwidth": 1920,
    "screenheight": 1080,
    "duration": 0,
    "repeat": 0,
    "arealist": [
      {
        "areaid": "area_001",
        "areaname": "主视频区",
        "areax": 0,
        "areay": 0,
        "areawidth": 1920,
        "areaheight": 1080,
        "areatype": 2,
        "alpha": 255,
        "bkcolor": "#000000",
        "reslist": [
          {
            "resid": "res_001",
            "file": {
              "filename": "promo_video.mp4",
              "fileurl": "http://example.com/videos/promo_video.mp4",
              "filesize": 10485760,
              "md5": "abc123def456"
            },
            "show": 0,
            "showtime": 0,
            "text": null,
            "font": null
          }
        ]
      }
    ]
  },
  "description": "商场一楼早间促销广告播放"
}
```

### 7002通知示例

**添加/修改任务**:
```json
{
  "method": 7002,
  "params": {
    "type": 1,
    "playlist": [
      {
        "playid": "play_001",
        ...
      }
    ]
  }
}
```

**删除任务**:
```json
{
  "method": 7002,
  "params": {
    "type": 0,
    "playlist": [
      {
        "playid": "play_001"
      }
    ]
  }
}
```

---

## ✅ 演示检查清单

在演示前，请确认：

- [ ] 项目已启动（npm run dev）
- [ ] 浏览器已打开（http://localhost:8080）
- [ ] 浏览器控制台已打开（F12）
- [ ] 网络连接正常
- [ ] 了解Mock数据内容
- [ ] 熟悉操作流程

在演示时，请展示：

- [ ] 播放任务列表
- [ ] 添加新任务
- [ ] 编辑任务
- [ ] 删除任务
- [ ] 状态切换
- [ ] 搜索筛选
- [ ] JSON预览
- [ ] SN匹配逻辑
- [ ] 7002通知日志
- [ ] 复制JSON功能

---

## 🎓 演示话术建议

### 开场
"这是我们开发的播放设置模块，用于管理广告播放任务。让我来演示一下主要功能。"

### 功能介绍
"首先，我们可以看到播放任务列表，显示了所有配置的播放任务。每个任务包含设备信息、时间设置、周期配置等。"

### 添加任务
"现在我来添加一个新的播放任务。我们可以配置SN匹配方式，支持精确匹配、前缀匹配和全部设备三种模式。"

### SN匹配
"这里的SN匹配是一个亮点功能。精确匹配适用于单个设备，前缀匹配可以匹配一批设备，全部设备则是广播模式。"

### JSON预览
"在JSON预览页面，我们可以模拟设备请求播放列表。输入设备SN后，系统会根据匹配规则返回该设备应该播放的任务列表。"

### 7002通知
"每次数据变更，系统都会触发7002通知。在实际环境中，这些通知会通过MQTT推送到设备。"

### 总结
"以上就是播放设置模块的主要功能。所有功能都使用Mock数据，方便开发和测试。后续可以很容易地接入真实的后端API。"

---

## 📞 常见问题解答

**Q: 为什么刷新页面后数据会重置？**
A: 当前使用Mock数据存储在内存中，刷新会重置。演示时可以说明这是为了方便测试，实际环境会使用数据库持久化。

**Q: 7002通知在哪里查看？**
A: 有两个地方：1) 浏览器控制台，2) JSON预览页面的通知日志。

**Q: 如何验证SN匹配逻辑？**
A: 在JSON预览页面输入不同的SN号，观察返回的任务列表是否符合匹配规则。

**Q: 周期设置如何工作？**
A: 只有勾选的星期才会播放。在列表中用彩色标签展示，绿色表示启用，灰色表示停用。

---

希望这份演示说明能帮助您顺利展示播放设置功能！
